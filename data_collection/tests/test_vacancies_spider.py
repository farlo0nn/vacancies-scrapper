import pytest 
import requests

from logger import logger
from scrapy.http import TextResponse
from pracujpl.spiders.vacancies_spider import VacanciesSpider


@pytest.fixture
def response() -> TextResponse:
    html = """
    <div class="oufs4ea c6g9djq" data-test="section-offerHeader" id="offer-header"><div class="cy9wb15"><div class="cmqurxq"><div data-test="section-company-logo" data-scroll-id="offer-view-logo" class="lx6h3ug"><picture data-test="picture-responsive" class="s1kjm9u"><source data-test="source-responsive" media="(min-width: 1024px)" srcset="https://logos.gpcdn.pl/loga-firm/1074112915/f15b0000-56be-0050-8e4b-08dc4371ee0c_280x280.png?width=80&amp;height=80&amp;sharpen=95 1x, https://logos.gpcdn.pl/loga-firm/1074112915/f15b0000-56be-0050-8e4b-08dc4371ee0c_280x280.png?width=160&amp;height=160&amp;sharpen=95 2x"><img loading="lazy" src="https://logos.gpcdn.pl/loga-firm/1074112915/f15b0000-56be-0050-8e4b-08dc4371ee0c_280x280.png" srcset="https://logos.gpcdn.pl/loga-firm/1074112915/f15b0000-56be-0050-8e4b-08dc4371ee0c_280x280.png?width=65&amp;height=65&amp;sharpen=95 1x, https://logos.gpcdn.pl/loga-firm/1074112915/f15b0000-56be-0050-8e4b-08dc4371ee0c_280x280.png?width=130&amp;height=130&amp;sharpen=95 2x" alt="INK SOLUTIONS SPÓŁKA Z OGRANICZONĄ ODPOWIEDZIALNOŚCIĄ" data-test="image-responsive" class="core_ia9ocxs"></picture></div><div data-test="section-offer-job-details" class="oxyemnv"><h1 data-scroll-id="job-title" data-test="text-positionName" class="oheatec">Junior Java Engineer</h1><h2 data-scroll-id="employer-name" data-test="text-employerName" class="c4wjx6a">INK SOLUTIONS SPÓŁKA Z OGRANICZONĄ ODPOWIEDZIALNOŚCIĄ<a class="s12nr7bh sd67gxc core_btsqgu core_n194fgoq" href="#company-details" tabindex="0" style="touch-action: pan-x pan-y pinch-zoom;">O firmie</a></h2><div class="d1xoo502 bkz2bdc" data-test="section-duration-info" data-test-duration-info="true" data-scroll-id="publication-dates"><div class="p1d5d3h3"><div class="p1myj957" style="--p1myj957-0:64.03022819203863%"></div></div><div class="d1g7jy9z"><p class="_typography_3mfx0_1 _typography--caption_3mfx0_1 _typography--semiBold_3mfx0_1 _typography--veryGrayColor_3mfx0_1">ważna jeszcze 16 dni</p><p class="_typography_3mfx0_1 _typography--caption_3mfx0_1 _typography--semiBold_3mfx0_1 _typography--grayColor_3mfx0_1">(<!-- -->do 31 sie<!-- -->)</p></div></div></div></div><div class="bploql"><button class="f1akiqd5 b1qfa42d" title="Zapisz ofertę" data-test="add-to-favourites"><span class="ai11k7x core_ig18o8w size-medium position-center"><svg role="img" alt="" viewBox="0 0 24 24" fill="none"><path d="M9.605 1.271a.419.419 0 0 1 .783 0l2.12 6.008h5.984a.418.418 0 0 1 .272.737l-5 4.146 2.092 6.287a.419.419 0 0 1-.644.47l-5.216-3.827-5.219 3.827a.419.419 0 0 1-.642-.47l2.093-6.287-5.001-4.146a.419.419 0 0 1 .272-.737h5.985l2.12-6.008z" stroke="#676B8D" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path></svg></span><span class="hibj2n3 hctw303 t127okx4" data-test="add-to-favourites-text">Zapisz</span></button></div></div><div class="c1qaeiqg" data-test="section-salary"><svg width="24" height="24" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round" fill="none" aria-hidden="true" role="graphics-symbol" viewBox="0 0 24 24" class="s421pdt"><g><path d="M3 5.533c0 .672.534 1.317 1.484 1.792.95.475 2.239.742 3.583.742 1.343 0 2.632-.267 3.582-.742.95-.475 1.484-1.12 1.484-1.792M3 5.533c0-.672.534-1.316 1.484-1.791C5.434 3.267 6.723 3 8.067 3c1.343 0 2.632.267 3.582.742.95.475 1.484 1.12 1.484 1.791M3 5.533V18.2c0 1.402 2.272 2.533 5.067 2.533.477.002.954-.032 1.427-.101m3.64-15.099-.001 3.378M3 15.033c0 1.402 2.272 2.534 5.067 2.534.489-.002.977-.038 1.46-.11M3 11.867C3 13.27 5.272 14.4 8.067 14.4c.477.002.954-.032 1.427-.1M3 8.7c0 1.401 2.272 2.533 5.067 2.533.489-.002.977-.038 1.46-.11m2.338 2.22c0 .673.534 1.317 1.484 1.792.95.475 2.24.742 3.583.742 1.344 0 2.632-.267 3.583-.742.95-.475 1.484-1.12 1.484-1.791m-10.134 0c0-.672.534-1.316 1.484-1.791.95-.476 2.24-.743 3.583-.743 1.344 0 2.632.268 3.583.742.95.476 1.484 1.12 1.484 1.792m-10.134 0v6.122c0 1.402 2.272 2.533 5.067 2.533 2.795 0 5.066-1.131 5.066-2.533v-6.122m0 2.955c0 1.402-2.271 2.533-5.066 2.533s-5.067-1.131-5.067-2.533"></path></g></svg><div data-scroll-id="contract-types-salary" class="s1934c5s"><div class="s120d0xa"><div data-test="section-salaryPerContractType" class="c1reytd8"><div data-test="text-earningAmount" class="vuj7wmi">5&nbsp;000<!-- --> <!-- -->zł</div><span class="i1a2mwv0">brutto / mies.<span data-test="text-contractTypeName"> <!-- -->| <!-- -->umowa o pracę</span></span></div><div class="d1125kpg"></div></div><div class="s120d0xa"><div data-test="section-salaryPerContractType" class="c1reytd8"><div data-test="text-earningAmount" class="vuj7wmi">5&nbsp;000<!-- --> <!-- -->zł</div><span class="i1a2mwv0">brutto / mies.<span data-test="text-contractTypeName"> <!-- -->| <!-- -->umowa zlecenie</span></span></div></div></div></div><div class="dm75nbj"></div><ul data-test="sections-benefit-list" class="caor1s3"><div data-scroll-id="publication-dates" class="d12d1rci"><div class="i1xiyn9n"><svg width="24" height="24" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round" fill="none" aria-hidden="true" role="graphics-symbol" viewBox="0 0 24 24"><g><path d="M12 8.786V12l4.017 4.018M3 12a9 9 0 1 0 18 0 9 9 0 0 0-18 0Z"></path></g></svg></div><div class="d1t11j3q bkz2bdc" data-test="section-duration-info" data-test-duration-info="true" data-scroll-id="publication-dates"><div class="p1d5d3h3"><div class="p1myj957" style="--p1myj957-0:64.03022821743984%"></div></div><div class="d1g7jy9z"><p class="_typography_3mfx0_1 _typography--body_3mfx0_1 _typography--semiBold_3mfx0_1 _typography--veryGrayColor_3mfx0_1">ważna jeszcze 16 dni</p><p class="_typography_3mfx0_1 _typography--caption_3mfx0_1 _typography--semiBold_3mfx0_1 _typography--grayColor_3mfx0_1">(<!-- -->do 31 sie<!-- -->)</p></div></div></div><a class="wv9o0p1 sd67gxc core_btsqgu core_n194fgoq" href="#map-frame" tabindex="0" style="touch-action: pan-x pan-y pinch-zoom;"><li data-test="sections-benefit-workplaces" data-scroll-id="workplaces" class="c196gesj"><div class="i1xiyn9n"><svg width="24" height="24" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round" fill="none" aria-hidden="true" role="graphics-symbol" viewBox="0 0 24 24"><g><path d="M8.375 10.75a3.375 3.375 0 1 0 6.75 0 3.375 3.375 0 0 0-6.75 0Z"></path><path d="M18.5 10.75c0 5.925-5.199 9.248-6.472 9.975a.562.562 0 0 1-.557 0C10.198 19.997 5 16.673 5 10.75a6.75 6.75 0 0 1 13.5 0Z"></path></g></svg></div><div class="tchzayo"><div data-test="offer-badge-title" class="t1g3wgsd">Świętego Jana 20, Stare Miasto, Kraków<span data-test="offer-badge-description" class="bnch6n6 d1urwcho">(małopolskie)</span></div></div></li></a><li data-test="sections-benefit-contracts" data-scroll-id="contract-types" class="lowercase c196gesj"><div class="i1xiyn9n"><svg width="24" height="24" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round" fill="none" aria-hidden="true" role="graphics-symbol" viewBox="0 0 24 24"><g><path d="M9.188 9.678h6.071m-6.071 3.4h6.071m-6.071 3.4h3.857m6.122 3.889c0 .3-.113.588-.312.801-.2.213-.47.332-.753.332H6.065c-.283 0-.553-.12-.753-.332-.2-.212-.312-.5-.312-.801V5.633c0-.3.112-.589.312-.801.2-.213.47-.332.753-.332h9.939c.278 0 .545.115.744.322L18.845 7c.102.106.183.232.238.371.055.14.084.29.084.44v12.556Z"></path></g></svg></div><div class="tchzayo"><div data-test="offer-badge-title" class="t1g3wgsd">umowa o pracę, umowa zlecenie</div></div></li><li data-test="sections-benefit-work-schedule" data-scroll-id="work-schedules" class="lowercase c196gesj"><div class="i1xiyn9n"><svg width="24" height="24" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round" fill="none" aria-hidden="true" role="graphics-symbol" viewBox="0 0 24 24"><g><path d="M11.501 21.502a9.501 9.501 0 1 0 0-19.002 9.501 9.501 0 0 0 0 19.002Z"></path><path d="M11.502 6.726a5.278 5.278 0 1 1-3.732 9.01l3.732-3.732V6.726Z"></path></g></svg></div><div class="tchzayo"><div data-test="offer-badge-title" class="t1g3wgsd">pełny etat</div></div></li><li data-test="sections-benefit-employment-type-name" data-scroll-id="position-levels" class="lowercase c196gesj"><div class="i1xiyn9n"><svg width="24" height="24" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round" fill="none" aria-hidden="true" role="graphics-symbol" viewBox="0 0 24 24"><g><path d="M20.333 4.5h-2.669a.663.663 0 0 0-.472.198.68.68 0 0 0-.195.477V20.5H21V5.175a.68.68 0 0 0-.195-.477.663.663 0 0 0-.472-.198Zm-7.03 4.284h-2.67a.663.663 0 0 0-.47.197.68.68 0 0 0-.196.478V20.5h4.003V9.459a.68.68 0 0 0-.196-.478.663.663 0 0 0-.471-.197Zm-6.967 4.56H3.667a.663.663 0 0 0-.471.198.68.68 0 0 0-.196.477V20.5h4.003v-6.48a.68.68 0 0 0-.195-.478.663.663 0 0 0-.472-.198Z"></path></g></svg></div><div class="tchzayo"><div data-test="offer-badge-title" class="t1g3wgsd">młodszy specjalista (Junior)</div></div></li><li data-test="sections-benefit-work-modes-hybrid" data-scroll-id="work-modes" class="lowercase c196gesj"><div class="i1xiyn9n"><svg width="24" height="24" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round" fill="none" aria-hidden="true" role="graphics-symbol" viewBox="0 0 24 24"><g><path d="m3 14.094 5.586-4.087m0 0 5.586 4.087m-5.586-4.087V3.8H21v17.38H4.016m0-7.45v7.177m9.14-7.176v7.176"></path></g></svg></div><div class="tchzayo"><div data-test="offer-badge-title" class="t1g3wgsd">praca hybrydowa</div></div></li><li data-test="sections-benefit-immediate-employment" data-scroll-id="attribute-primary-immediate-employment" class="lowercase c196gesj"><div class="i1xiyn9n"><svg width="24" height="24" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round" fill="none" aria-hidden="true" role="graphics-symbol" viewBox="0 0 24 24"><g><path d="m16.07 15.175-.006.318a2.983 2.983 0 0 1-2.988 2.923M11.593 2.55a.482.482 0 0 0-.536.075.412.412 0 0 0-.087.505c1.665 3.072.52 7.28-1.758 9.654a5.573 5.573 0 0 1-1.375-2.623c-5.41 3.659-2.557 11.692 4.125 11.692 9.599.004 9.286-14.47-.369-19.303Z"></path></g></svg></div><div class="tchzayo"><div data-test="offer-badge-title" class="t1g3wgsd">Praca od zaraz</div></div></li><li data-test="sections-benefit-vacancies" data-scroll-id="attribute-primary-many-vacancies" class="lowercase c196gesj"><div class="i1xiyn9n"><svg width="24" height="24" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round" fill="none" aria-hidden="true" role="graphics-symbol" viewBox="0 0 24 24"><g><path d="M2 20.748c0-1.52.713-2.98 1.983-4.055 1.27-1.075 2.992-1.68 4.787-1.68 1.796 0 3.518.605 4.787 1.68 1.27 1.076 1.983 2.534 1.983 4.055M22 18.896c0-.973-.45-1.905-1.248-2.593-.8-.688-1.883-1.074-3.013-1.074s-2.214.386-3.012 1.074M4.9 8.323a3.8 3.8 0 0 0 1.134 2.703 3.892 3.892 0 0 0 2.735 1.12c1.026 0 2.01-.403 2.736-1.12a3.8 3.8 0 0 0 1.133-2.703 3.8 3.8 0 0 0-1.133-2.703A3.892 3.892 0 0 0 8.77 4.5a3.89 3.89 0 0 0-2.735 1.12A3.8 3.8 0 0 0 4.9 8.323Zm15.272 2.078a2.45 2.45 0 0 1-.713 1.728 2.43 2.43 0 0 1-3.443 0 2.45 2.45 0 0 1 0-3.457 2.43 2.43 0 0 1 3.443 0 2.45 2.45 0 0 1 .713 1.729Z"></path></g></svg></div><div class="tchzayo"><div data-test="offer-badge-title" class="t1g3wgsd">Szukamy wielu kandydatów<span data-test="offer-badge-description" class="lofng8k d1urwcho">(5 wakatów)</span></div></div></li><li lang="uk-UK" data-test="sections-benefit-ukrainian-friendly" data-scroll-id="attribute-primary-ukrainian-friendly" class="lowercase c196gesj"><div class="i1xiyn9n"><svg width="18" height="18" stroke="none" stroke-width="0" stroke-linecap="round" stroke-linejoin="round" fill="none" aria-hidden="false" role="graphics-symbol" viewBox="12.7578 11 18 18"><g filter="url(#a)"><path fill="#FFD500" d="M30.758 20a9 9 0 1 1-18 0h18Z"></path><path fill="#005BBB" d="M12.758 20a9 9 0 0 1 18 0h-18Z"></path></g><defs><filter id="a" width="42" height="42" x=".758" y="-1" color-interpolation-filters="sRGB" filterUnits="userSpaceOnUse"><feFlood flood-opacity="0" result="BackgroundImageFix"></feFlood><feColorMatrix in="SourceAlpha" result="hardAlpha" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"></feColorMatrix><feOffset></feOffset><feGaussianBlur stdDeviation="6"></feGaussianBlur><feColorMatrix values="0 0 0 0 0.12549 0 0 0 0 0.145098 0 0 0 0 0.341176 0 0 0 0.08 0"></feColorMatrix><feBlend in2="BackgroundImageFix" result="effect1_dropShadow_3335_19241"></feBlend><feBlend in="SourceGraphic" in2="effect1_dropShadow_3335_19241" result="shape"></feBlend></filter></defs></svg></div><div class="tchzayo"><div data-test="offer-badge-title" class="t1g3wgsd">Запрошуємо працівників з України</div></div></li><li lang="uk-UK" data-test="sections-benefit-no-polish-required" data-scroll-id="attribute-primary-ukrainian-without-polish-language" class="lowercase c196gesj"><div class="i1xiyn9n"><svg width="24" height="24" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round" fill="none" aria-hidden="true" role="graphics-symbol" viewBox="0 0 24 24"><g><path d="M19.931 10.816a8.914 8.914 0 1 0-8.789 10.409c-2.05 0-3.713-3.99-3.713-8.914 0-4.923 1.662-8.914 3.713-8.914 2.052 0 3.715 3.99 3.715 8.914a20.8 20.8 0 0 1-.211 2.971M2.736 9.34H19.55M2.737 15.283h12.862m-.884 4.303 2.016 2.016 5.038-5.039"></path></g></svg></div><div class="tchzayo"><div data-test="offer-badge-title" class="t1g3wgsd">Робота для іноземців<span data-test="offer-badge-description" class="lofng8k d1urwcho">(без польської)</span></div></div></li></ul></div>
    """
    response = TextResponse(
        url="https://www.pracuj.pl/praca/junior-java-engineer-krakow-swietego-jana-20,oferta,1004232840?sug=list_top_cr_bd_1_tname_252_tgroup_D_boosterAI_L2&s=1f7c2c91&searchId=MTc1NTI2MTUyOTUyOS40MjM=",
        body=html,
        encoding='utf-8'
    )
    return response 

@pytest.fixture
def spider() -> VacanciesSpider:
    v_spider = VacanciesSpider()
    return v_spider

def test_data_scraping(response: TextResponse):
    location = ' '.join(response.xpath('//li[@data-scroll-id="workplaces"]//text()').getall()).strip()
    contract_type = ' '.join(response.xpath('//li[@data-scroll-id="contract-types"]//text()').getall()).strip()
    logger.info(f"location: {location}, contract types: {contract_type}")
    assert location == "Świętego Jana 20, Stare Miasto, Kraków (małopolskie)"
